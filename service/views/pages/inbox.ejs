<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head'); %>
</head>
<body>

<header>
  <%- include('../partials/header'); %>
</header>

<main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="relative bg-white rounded-2xl p-8 border border-slate-200 shadow-sm overflow-hidden">
    <div class="absolute top-0 inset-x-0 h-1 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight mb-2">ðŸ“¨ Dispose Me</h1>
    <p class="text-slate-500 text-lg">A simple, disposable email service with easy API access.</p>
    <hr class="border-none h-px bg-slate-200 my-7">

    <form method="GET" action="/inbox">
      <label for="username" class="block text-sm font-semibold text-slate-700 mb-1.5">Your new inbox</label>
      <% const usernameError = (locals.errors ?? []).find((error) => error.type === "field" && error.path === "username"); %>
      <div class="flex flex-wrap items-end gap-2">
        <div class="flex-1 min-w-0">
          <input class="block w-full px-3.5 py-2 text-[15px] leading-6 text-slate-800 bg-white border-[1.5px] rounded-lg transition placeholder:text-slate-400 focus:outline-none focus:ring-[3px] <%= usernameError ? 'border-red-300 bg-red-50 focus:border-red-500 focus:ring-red-500/10' : 'border-slate-300 focus:border-indigo-500 focus:ring-indigo-500/10' %>" type="text" id="username" value="<%= usernameError?.value %>" placeholder="Inbox name" aria-label="Inbox name" required>
        </div>
        <input type="hidden" value="<%= query['x-api-key'] %>" name="x-api-key" <%= query['x-api-key'] ? "" : "disabled" %>>
        <span class="px-3.5 py-2 bg-slate-100 border-[1.5px] border-slate-300 rounded-lg text-slate-600 text-[15px] font-medium whitespace-nowrap">@<%= process.env.DOMAIN_NAME %></span>
        <button type="button" class="inline-flex items-center justify-center px-4 py-2 text-sm font-semibold rounded-lg bg-white text-slate-600 border border-slate-300 hover:bg-slate-50 hover:border-slate-400 hover:text-slate-800 transition-all focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500" aria-label="Generate new username" onclick="generateUsername();">
          <svg class="size-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.992 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182M2.985 19.644l-.002-.001"/></svg>
        </button>
        <button type="submit" class="inline-flex items-center justify-center px-4 py-2 text-sm font-semibold rounded-lg bg-gradient-to-br from-indigo-500 to-indigo-600 text-white shadow-sm shadow-indigo-500/30 hover:from-indigo-600 hover:to-indigo-700 hover:shadow-md hover:-translate-y-px transition-all focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500" aria-label="Go to inbox">
          <svg class="size-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15M12 9l3 3m0 0-3 3m3-3H2.25"/></svg>
        </button>
      </div>
      <% if (usernameError) { %>
        <p class="mt-1.5 text-[13px] font-medium text-red-500"><%= usernameError.msg %></p>
      <% } %>
    </form>
  </div>
</main>

<footer class="fixed inset-x-0 bottom-0 h-14 bg-white border-t border-slate-200 flex items-center z-40">
  <%- include('../partials/footer'); %>
</footer>

<script type="text/javascript">
  function generateUsername() {
    var my_chance = new Chance();
    var username = my_chance.name().replace(' ', '') + my_chance.integer({ min: 1, max: 99 });

    document.getElementById('username').value = username.toLowerCase();
  };

  document.addEventListener('DOMContentLoaded', function() {
    document.querySelector("form").addEventListener("submit", function(event) {
      var username = document.getElementById('username').value;
      var sanitizedUsername = encodeURIComponent(username);
      this.setAttribute('action', '/inbox/' + sanitizedUsername);
    });
  });
</script>

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js" integrity="sha512-PIisRT8mFfdxx99gMs7WAY5Gp+CtjYYxKvF93w8yWAvX548UBNADHu7Qkavgr6yRG+asocqfuk5crjNd5z9s6Q==" crossorigin="anonymous"></script>

<!-- Chance.js -->
<script src="https://chancejs.com/chance.min.js" integrity="sha512-oTAa0uPPR+/hLt+vfEjg/YzxHaY/rbc1OKDjbB0bAt1w+kP2yQvg/g+cu8/c0QaMbDpI8ECMCl4YXCxLJPIinQ==" crossorigin="anonymous"></script>

</body>
</html>
