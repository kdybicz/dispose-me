<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head'); %>
</head>
<body>

<header>
  <%- include('../partials/header'); %>
</header>

<main class="container-custom py-8">
  <div class="jumbotron">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">ðŸ“¨ Dispose Me</h1>
    <p class="text-xl text-gray-600 mb-6">I'm a simple, disposable email service with an easy API access.</p>
    <hr class="border-gray-200 my-6">

    <form method="GET" action="/inbox">
      <div class="flex flex-wrap items-end gap-2">
        <label for="username" class="form-label whitespace-nowrap">Your new inbox:</label>
        <% const usernameError = (locals.errors ?? []).find((error) => error.type === "field" && error.path === "username"); %>
        <div class="flex-1 min-w-0">
          <input class="<%= usernameError ? 'form-input-error' : 'form-input' %>" type="text" id="username" value="<%= usernameError?.value %>" placeholder="Inbox name" aria-label="Inbox name" required>
        </div>
        <input type="hidden" value="<%= query['x-api-key'] %>" name="x-api-key" <%= query['x-api-key'] ? "" : "disabled" %>>
        <span class="px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">@<%= process.env.DOMAIN_NAME %></span>
        <button type="button" class="btn-outline" aria-label="Generate new username" onclick="generateUsername();">
          <i class="bi bi-repeat"></i>
        </button>
        <button type="submit" class="btn-primary" aria-label="Go to inbox">
          <i class="bi bi-box-arrow-in-right"></i>
        </button>
      </div>
      <% if (usernameError) { %>
        <div class="form-error mt-2">
          <%= usernameError.msg %>
        </div>
      <% } %>
    </form>
  </div>
</main>

<footer class="footer">
  <%- include('../partials/footer'); %>
</footer>

<%- include('../partials/bootstrap'); %>

<script type="text/javascript">
  function generateUsername() {
    var my_chance = new Chance();
    var username = my_chance.name().replace(' ', '') + my_chance.integer({ min: 1, max: 99 });

    document.getElementById('username').value = username.toLowerCase();
  };

  document.addEventListener('DOMContentLoaded', function() {
    document.querySelector("form").addEventListener("submit", function(event) {
      var username = document.getElementById('username').value;
      var sanitizedUsername = encodeURIComponent(username);
      this.setAttribute('action', `/inbox/${sanitizedUsername}`);
    });
  });
</script>

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js" integrity="sha512-PIisRT8mFfdxx99gMs7WAY5Gp+CtjYYxKvF93w8yWAvX548UBNADHu7Qkavgr6yRG+asocqfuk5crjNd5z9s6Q==" crossorigin="anonymous"></script>

<!-- Chance.js -->
<script src="https://chancejs.com/chance.min.js" integrity="sha512-oTAa0uPPR+/hLt+vfEjg/YzxHaY/rbc1OKDjbB0bAt1w+kP2yQvg/g+cu8/c0QaMbDpI8ECMCl4YXCxLJPIinQ==" crossorigin="anonymous"></script>

</body>
</html>
